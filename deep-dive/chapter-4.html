<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Dive: Finding Direction (1997–2002) — Germinal Barrena</title>

    <meta name="description" content="Interactive infographic: Spain's internet revolution, economic boom, euro adoption, and university years. International comparisons 1997-2002.">
    <meta name="theme-color" content="#0a0a0a">

    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="deep-dive.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="dd-page">

    <!-- ============================================================ -->
    <!-- NAV -->
    <!-- ============================================================ -->
    <nav class="dd-nav">
        <div class="dd-nav__inner">
            <a href="../index.html#chapter-4" class="dd-nav__back">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                Back to Story
            </a>
            <div class="dd-nav__breadcrumb">
                <span class="dd-nav__chapter-num">04</span>
                <span class="dd-nav__separator">/</span>
                <span class="dd-nav__chapter-title">Finding Direction</span>
                <span class="dd-nav__separator">—</span>
                <span class="dd-nav__badge">Deep Dive</span>
            </div>
            <div class="dd-nav__arrows">
                <a href="chapter-3.html" class="dd-nav__arrow" title="Prev: Generation X">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                </a>
                <a href="chapter-5.html" class="dd-nav__arrow" title="Next: The Designer">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                </a>
            </div>
        </div>
    </nav>

    <!-- ============================================================ -->
    <!-- HERO -->
    <!-- ============================================================ -->
    <header class="dd-hero">
        <div class="dd-hero__bg"></div>
        <div class="dd-hero__content">
            <div class="dd-hero__number">04</div>
            <h1 class="dd-hero__title">Finding Direction</h1>
            <p class="dd-hero__subtitle">University years, the dot-com revolution, and the search for purpose. Spain went from dial-up to the euro in five years.</p>
            <div class="dd-scope-toggle">
                <button class="dd-scope-btn" data-scope="spain">Spain</button>
                <button class="dd-scope-btn" data-scope="europe">Europe</button>
                <button class="dd-scope-btn" data-scope="world">World</button>
                <button class="dd-scope-btn active" data-scope="all">All</button>
            </div>
        </div>
    </header>

    <!-- ============================================================ -->
    <!-- SECTION 1: Internet Revolution -->
    <!-- ============================================================ -->
    <section class="dd-section" id="internet-revolution">
        <div class="dd-section__header">
            <span class="dd-section__number">01</span>
            <h2 class="dd-section__title">The Internet Revolution</h2>
        </div>
        <p class="dd-section__intro">Spain's internet penetration rocketed from 1% to 20% in just five years — but it was still playing catch-up. The US had 58% penetration by 2002 while Spain was barely discovering broadband. The dot-com bubble inflated and burst, taking Terra Networks and millions in dreams with it.</p>

        <div class="dd-kpi-grid">
            <div class="dd-kpi-card" data-value="20" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Internet 2002</span>
                <span class="dd-kpi-card__country">Spain (was 1% in '97)</span>
            </div>
            <div class="dd-kpi-card" data-value="58" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Internet 2002</span>
                <span class="dd-kpi-card__country">USA (3x Spain)</span>
            </div>
            <div class="dd-kpi-card" data-value="5" data-suffix="M" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Spain Users</span>
                <span class="dd-kpi-card__country">~2000</span>
            </div>
            <div class="dd-kpi-card" data-value="4" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Broadband</span>
                <span class="dd-kpi-card__country">Spain 2002 (vs 55% Korea)</span>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Internet Penetration (% of population, 1995–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-internet">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                        <button class="dd-series-btn active" data-series="USA">US</button>
                        <button class="dd-series-btn active" data-series="Japan">JP</button>
                        <button class="dd-series-btn active" data-series="World">WLD</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-internet"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Internet Users by Country (~2000, millions)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-users"></div>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">NASDAQ Index & Dot-Com Events (1997–2002)</h3>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-nasdaq"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Broadband Adoption 2002 (%)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-broadband"></div>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- SECTION 2: Economic Boom -->
    <!-- ============================================================ -->
    <section class="dd-section" id="economic-boom">
        <div class="dd-section__header">
            <span class="dd-section__number">02</span>
            <h2 class="dd-section__title">Spain's Economic Boom</h2>
        </div>
        <p class="dd-section__intro">Under Aznar's government, Spain achieved record GDP growth and slashed unemployment from 23% to 11%. The construction sector boomed (+62%), telecommunications exploded (+180%), and 3.5 million jobs were created. But the seeds of a future crisis were being planted.</p>

        <div class="dd-kpi-grid">
            <div class="dd-kpi-card" data-value="5.0" data-suffix="%" data-decimals="1">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Peak GDP Growth</span>
                <span class="dd-kpi-card__country">Spain, 2000</span>
            </div>
            <div class="dd-kpi-card" data-value="3.5" data-suffix="M" data-decimals="1">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Jobs Created</span>
                <span class="dd-kpi-card__country">1997–2002</span>
            </div>
            <div class="dd-kpi-card" data-value="11.5" data-suffix="%" data-decimals="1">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Unemployment</span>
                <span class="dd-kpi-card__country">2002 (was 23% in '95)</span>
            </div>
            <div class="dd-kpi-card" data-value="180" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Telecom Growth</span>
                <span class="dd-kpi-card__country">1997–2002</span>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">GDP Growth (%, 1995–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-gdp">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                        <button class="dd-series-btn active" data-series="USA">US</button>
                        <button class="dd-series-btn active" data-series="EU Avg">EU</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-gdp"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Unemployment Rate (%, 1995–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-unemployment">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                        <button class="dd-series-btn active" data-series="USA">US</button>
                        <button class="dd-series-btn active" data-series="EU Avg">EU</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-unemployment"></div>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Spain Sector Growth 1997–2002 (%)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-sectors"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Jobs Created per Year in Spain (thousands)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-jobs"></div>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- SECTION 3: University & Education -->
    <!-- ============================================================ -->
    <section class="dd-section" id="university-education">
        <div class="dd-section__header">
            <span class="dd-section__number">03</span>
            <h2 class="dd-section__title">University & Education</h2>
        </div>
        <p class="dd-section__intro">Spain hit peak university enrollment at 1.61 million students in 1998 — then began a slow decline. Despite this, Spain's tertiary enrollment rate (45%) matched France and exceeded Germany. But only 33% actually completed their degrees, one of the lowest rates in Europe.</p>

        <div class="dd-kpi-grid">
            <div class="dd-kpi-card" data-value="1.61" data-suffix="M" data-decimals="2">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Peak Enrollment</span>
                <span class="dd-kpi-card__country">Spain, 1998</span>
            </div>
            <div class="dd-kpi-card" data-value="45" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Tertiary Rate</span>
                <span class="dd-kpi-card__country">18-24 enrolled, 2000</span>
            </div>
            <div class="dd-kpi-card" data-value="33" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Completion Rate</span>
                <span class="dd-kpi-card__country">Spain (EU avg: 35%)</span>
            </div>
            <div class="dd-kpi-card" data-value="38" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Social Sci & Law</span>
                <span class="dd-kpi-card__country">Top field in Spain</span>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">University Enrollment (thousands, 1995–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-enrollment">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-enrollment"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Tertiary Enrollment Rate 2000 (%)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-tertiary"></div>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Graduation Rate 2000 (% of cohort)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-graduation"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Fields of Study ~2000 (%)</h3>
                    <div class="dd-series-toggle" id="toggle-fields">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-fields"></div>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- SECTION 4: Euro & Globalization -->
    <!-- ============================================================ -->
    <section class="dd-section" id="euro-globalization">
        <div class="dd-section__header">
            <span class="dd-section__number">04</span>
            <h2 class="dd-section__title">The Euro & Globalization</h2>
        </div>
        <p class="dd-section__intro">Spain tamed inflation from 4.7% to 2% to meet the Maastricht criteria. On January 1, 2002, the peseta disappeared and 166.386 became the number every Spaniard memorized. Foreign investment flooded in, and Spain became a fully integrated European economy.</p>

        <div class="dd-kpi-grid">
            <div class="dd-kpi-card" data-value="166.386" data-suffix="" data-decimals="3">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">PTA per Euro</span>
                <span class="dd-kpi-card__country">The magic number</span>
            </div>
            <div class="dd-kpi-card" data-value="2.0" data-suffix="%" data-decimals="1">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Inflation 1997</span>
                <span class="dd-kpi-card__country">Down from 4.7% in '95</span>
            </div>
            <div class="dd-kpi-card" data-value="39.6" data-suffix="B$" data-decimals="1">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Peak FDI</span>
                <span class="dd-kpi-card__country">Spain, 2000</span>
            </div>
            <div class="dd-kpi-card" data-value="12" data-suffix="" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Euro Countries</span>
                <span class="dd-kpi-card__country">Initial launch, 1999</span>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Inflation Convergence (%, 1995–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-inflation">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="Italy">IT</button>
                        <button class="dd-series-btn active" data-series="EU Avg">EU</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-inflation"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Final Exchange Rate to Euro</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-exchange"></div>
            </div>
        </div>

        <div class="dd-chart-grid dd-chart-grid--full">
            <div class="dd-chart-card dd-chart-card--full">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Foreign Direct Investment Inflows (USD billions, 1997–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-fdi">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-fdi"></div>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- SECTION 5: Tech & Society -->
    <!-- ============================================================ -->
    <section class="dd-section" id="tech-society">
        <div class="dd-section__header">
            <span class="dd-section__number">05</span>
            <h2 class="dd-section__title">Tech & Society</h2>
        </div>
        <p class="dd-section__intro">The mobile phone revolution was even more dramatic than the internet. Spain went from 11 to 82 mobile subscriptions per 100 people in just five years — one of the fastest adoptions in Europe. Italy reached 94%, while the US lagged at 49%. The Nokia 3310 was indestructible, and everyone had one.</p>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Mobile Subscriptions per 100 People (1997–2002)</h3>
                    <div class="dd-series-toggle" id="toggle-mobile">
                        <button class="dd-series-btn active" data-series="Spain">ES</button>
                        <button class="dd-series-btn active" data-series="France">FR</button>
                        <button class="dd-series-btn active" data-series="Germany">DE</button>
                        <button class="dd-series-btn active" data-series="UK">UK</button>
                        <button class="dd-series-btn active" data-series="Italy">IT</button>
                        <button class="dd-series-btn active" data-series="USA">US</button>
                    </div>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-mobile"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Households with a Computer ~2000 (%)</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--short" id="chart-dd-pc"></div>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- SECTION 6: Personal -->
    <!-- ============================================================ -->
    <section class="dd-section" id="personal">
        <div class="dd-section__header">
            <span class="dd-section__number">06</span>
            <h2 class="dd-section__title">Personal Connection</h2>
        </div>
        <p class="dd-section__intro">I entered Universidad de Extremadura in 1997 and left without a degree in 2002. It wasn't failure — it was redirection. While Spain connected to the internet, I was discovering that my true skills lay outside the classroom: design, visual communication, and the self-taught path.</p>

        <div class="dd-kpi-grid">
            <div class="dd-kpi-card" data-value="5" data-suffix=" yrs" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">At University</span>
                <span class="dd-kpi-card__country">1997–2002</span>
            </div>
            <div class="dd-kpi-card" data-value="1999" data-suffix="" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">First Internet</span>
                <span class="dd-kpi-card__country">Personal access</span>
            </div>
            <div class="dd-kpi-card" data-value="1999" data-suffix="" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">First Mobile</span>
                <span class="dd-kpi-card__country">Personal phone</span>
            </div>
            <div class="dd-kpi-card" data-value="33" data-suffix="%" data-decimals="0">
                <span class="dd-kpi-card__value">0</span>
                <span class="dd-kpi-card__label">Completed Degree</span>
                <span class="dd-kpi-card__country">Spain avg (I didn't)</span>
            </div>
        </div>

        <div class="dd-chart-grid">
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">My University Journey vs Spain's Milestones</h3>
                </div>
                <div class="dd-chart-card__chart dd-chart-card__chart--tall" id="chart-dd-mypath"></div>
            </div>
            <div class="dd-chart-card">
                <div class="dd-chart-card__header">
                    <h3 class="dd-chart-card__title">Born 1978 vs Born 1988 — at Age 20</h3>
                </div>
                <div class="dd-chart-card__chart" id="chart-dd-generations"></div>
            </div>
        </div>

        <div class="dd-location-card">
            <div class="dd-location-card__icon">
                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                    <circle cx="24" cy="24" r="12" stroke="currentColor" stroke-width="1.5" opacity="0.5"/>
                    <circle cx="24" cy="24" r="4" fill="currentColor" class="dd-location-card__pulse"/>
                </svg>
            </div>
            <div class="dd-location-card__info">
                <span class="dd-location-card__name">Universidad de Extremadura — Caceres</span>
                <span class="dd-location-card__detail">Extremadura, Spain &middot; 1997–2002</span>
                <span class="dd-location-card__note">"Traditional academic paths are not for everyone. Failure is redirection, not a dead end."</span>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- FOOTER -->
    <!-- ============================================================ -->
    <footer class="dd-footer">
        <div class="dd-footer__sources">
            <h4>Data Sources &amp; References</h4>
            <div class="dd-sources-grid">
                <div class="dd-source">
                    <span class="dd-source__section">Internet &amp; Tech</span>
                    <ul>
                        <li><a href="https://www.itu.int/en/ITU-D/Statistics/Pages/stat/default.aspx" target="_blank" rel="noopener">ITU — International Telecommunication Union</a> (internet penetration, mobile subscriptions)</li>
                        <li><a href="https://data.worldbank.org/indicator/IT.NET.USER.ZS" target="_blank" rel="noopener">World Bank — Internet users</a></li>
                        <li><a href="https://www.ine.es/dyngs/INEbase/es/operacion.htm?c=Estadistica_C&cid=1254736176741&menu=resultados&idp=1254735576692" target="_blank" rel="noopener">INE — TIC en hogares</a> (technology in Spanish households)</li>
                    </ul>
                </div>
                <div class="dd-source">
                    <span class="dd-source__section">Economy</span>
                    <ul>
                        <li><a href="https://data.worldbank.org/indicator/NY.GDP.MKTP.KD.ZG" target="_blank" rel="noopener">World Bank — GDP growth</a></li>
                        <li><a href="https://ec.europa.eu/eurostat/web/labour-market" target="_blank" rel="noopener">Eurostat — Labour Force Survey</a> (unemployment)</li>
                        <li><a href="https://stats.oecd.org/" target="_blank" rel="noopener">OECD — Economic Outlook</a></li>
                    </ul>
                </div>
                <div class="dd-source">
                    <span class="dd-source__section">Education</span>
                    <ul>
                        <li><a href="https://www.educacionyfp.gob.es/servicios-al-ciudadano/estadisticas.html" target="_blank" rel="noopener">Ministerio de Educacion — Estadisticas universitarias</a></li>
                        <li><a href="https://www.oecd.org/education/education-at-a-glance/" target="_blank" rel="noopener">OECD — Education at a Glance</a></li>
                    </ul>
                </div>
                <div class="dd-source">
                    <span class="dd-source__section">Euro &amp; Globalization</span>
                    <ul>
                        <li><a href="https://www.ecb.europa.eu/euro/intro/html/index.en.html" target="_blank" rel="noopener">European Central Bank — Euro history</a></li>
                        <li><a href="https://unctad.org/topic/investment/world-investment-report" target="_blank" rel="noopener">UNCTAD — Foreign Direct Investment</a></li>
                    </ul>
                </div>
            </div>
            <p class="dd-sources-note">Some figures are estimates or approximations based on the closest available data point. International comparisons use standardized indicators where possible. Historical data may have been revised by source institutions since original publication.</p>
        </div>
        <div class="dd-footer__nav">
            <a href="../index.html#chapter-4" class="dd-footer__back">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                Back to Story
            </a>
            <span class="dd-footer__copyright">Germinal Barrena &copy; 2026</span>
        </div>
    </footer>

    <!-- ============================================================ -->
    <!-- SCRIPTS -->
    <!-- ============================================================ -->
    <script src="deep-dive-core.js"></script>
    <script>
    (function() {
        'use strict';

        var DATA = null;
        var CC = DiveDeep.countryColors;
        var CN = DiveDeep.countryNames;

        CN['EU'] = 'EU Avg';
        CC['EU'] = '#86868b';
        CC['KR'] = '#00c7be';

        fetch('../data/deep-dive-university-1997-2002.json')
            .then(function(r) { return r.json(); })
            .then(function(json) {
                DATA = json;
                initPage();
            })
            .catch(function(err) {
                console.error('Failed to load data:', err);
                initPage();
            });

        function initPage() {
            DiveDeep.initDiveDeep({
                accentColor: '#5856d6',
                accentRgb: '88,86,214'
            });

            if (DATA) {
                initInternetCharts();
                initEconomyCharts();
                initUniversityCharts();
                initEuroCharts();
                initTechCharts();
                initPersonalCharts();
                initScopeUpdates();
            }

            initSeriesToggles();
        }

        // ============================================================
        // SECTION 1: Internet Revolution
        // ============================================================
        function initInternetCharts() {
            var ir = DATA.internet_revolution;

            // Internet penetration trend
            var ipSeries = [];
            ['ES','FR','DE','UK','US','JP','World'].forEach(function(code) {
                ipSeries.push({
                    name: CN[code] || code,
                    data: ir.internet_penetration_trend.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-internet', DiveDeep.getBaseChartConfig({
                series: ipSeries,
                chart: { type: 'area', height: 280 },
                colors: ['ES','FR','DE','UK','US','JP','World'].map(function(c) { return CC[c] || '#888'; }),
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.2, opacityTo: 0.02 } },
                stroke: { curve: 'smooth', width: 2.5 },
                xaxis: { categories: ir.internet_penetration_trend.years },
                yaxis: { min: 0, max: 65, labels: { formatter: function(v) { return v + '%'; } } },
                tooltip: { y: { formatter: function(v) { return v + '% of population'; } } },
                legend: { position: 'bottom' }
            }), ipSeries);

            // Internet users 2000
            var users = ir.internet_users_2000;
            var userColors = users.countries.map(function(c) { return c === 'ES' ? CC.ES : (CC[c] || '#86868b'); });

            DiveDeep.renderChart('#chart-dd-users', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Users (M)', data: users.values }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: userColors,
                xaxis: { categories: users.labels },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '12px' } } },
                dataLabels: { enabled: true, formatter: function(v) { return v + 'M'; }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) { return v + ' million users'; } } }
            }));

            // NASDAQ dot-com
            var dc = ir.dotcom_timeline;
            var annotations = dc.events.map(function(ev, i) {
                return {
                    x: dc.years[i],
                    borderColor: i === 3 ? '#ff3b30' : 'rgba(88,86,214,0.5)',
                    strokeDashArray: i === 3 ? 0 : 4,
                    label: {
                        text: ev,
                        orientation: 'horizontal',
                        position: i % 2 === 0 ? 'top' : 'bottom',
                        style: {
                            background: i === 3 ? '#ff3b30' : '#222',
                            color: '#f0f0f0',
                            fontSize: '9px',
                            padding: { left: 4, right: 4, top: 2, bottom: 2 }
                        }
                    }
                };
            });

            DiveDeep.renderChart('#chart-dd-nasdaq', DiveDeep.getBaseChartConfig({
                series: [{ name: 'NASDAQ', data: dc.nasdaq }],
                chart: { type: 'area', height: 280 },
                colors: ['#5856d6'],
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.05 } },
                stroke: { curve: 'smooth', width: 3 },
                markers: { size: 5, hover: { size: 7 } },
                xaxis: { categories: dc.years },
                yaxis: { labels: { formatter: function(v) { return (v/1000).toFixed(1) + 'K'; } } },
                annotations: { xaxis: annotations },
                tooltip: { y: { formatter: function(v) { return v.toLocaleString() + ' pts'; } } }
            }));

            // Broadband 2002
            var bb = ir.broadband_pct_2002;
            var bbColors = bb.countries.map(function(c) { return c === 'ES' ? CC.ES : (CC[c] || '#86868b'); });

            DiveDeep.renderChart('#chart-dd-broadband', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Broadband %', data: bb.values }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: bbColors,
                xaxis: { categories: bb.labels },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '12px' } } },
                dataLabels: { enabled: true, formatter: function(v) { return v + '%'; }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) { return v + '% broadband'; } } }
            }));
        }

        // ============================================================
        // SECTION 2: Economic Boom
        // ============================================================
        function initEconomyCharts() {
            var eco = DATA.economic_boom;

            // GDP growth
            var gdpSeries = [];
            ['ES','FR','DE','UK','US','EU'].forEach(function(code) {
                gdpSeries.push({
                    name: CN[code] || code,
                    data: eco.gdp_growth_trend.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-gdp', DiveDeep.getBaseChartConfig({
                series: gdpSeries,
                chart: { type: 'line', height: 280 },
                colors: ['ES','FR','DE','UK','US','EU'].map(function(c) { return CC[c]; }),
                stroke: { curve: 'smooth', width: 2.5 },
                markers: { size: 3 },
                xaxis: { categories: eco.gdp_growth_trend.years },
                yaxis: { min: -1, max: 6, labels: { formatter: function(v) { return v + '%'; } } },
                tooltip: { y: { formatter: function(v) { return v + '% GDP growth'; } } },
                legend: { position: 'bottom' },
                annotations: {
                    yaxis: [{ y: 0, borderColor: 'rgba(255,255,255,0.2)', strokeDashArray: 0 }],
                    xaxis: [{ x: 2001, borderColor: '#ff3b30', strokeDashArray: 4, label: { text: '9/11 & Slowdown', style: { background: '#ff3b30', color: '#fff', fontSize: '9px' } } }]
                }
            }), gdpSeries);

            // Unemployment
            var unempSeries = [];
            ['ES','FR','DE','UK','US','EU'].forEach(function(code) {
                unempSeries.push({
                    name: CN[code] || code,
                    data: eco.unemployment_trend.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-unemployment', DiveDeep.getBaseChartConfig({
                series: unempSeries,
                chart: { type: 'line', height: 280 },
                colors: ['ES','FR','DE','UK','US','EU'].map(function(c) { return CC[c]; }),
                stroke: { curve: 'smooth', width: 2.5 },
                markers: { size: 3 },
                xaxis: { categories: eco.unemployment_trend.years },
                yaxis: { min: 0, max: 25, labels: { formatter: function(v) { return v + '%'; } } },
                tooltip: { y: { formatter: function(v) { return v + '% unemployment'; } } },
                legend: { position: 'bottom' }
            }), unempSeries);

            // Sector growth
            var sec = eco.sector_growth_spain;
            var sectorColors = ['#ff9500', '#5856d6', '#34c759', '#0071e3', '#ff6b6b'];

            DiveDeep.renderChart('#chart-dd-sectors', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Growth %', data: sec.growth_pct }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: sectorColors,
                xaxis: { categories: sec.categories },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '12px' } } },
                dataLabels: { enabled: true, formatter: function(v) { return '+' + v + '%'; }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) { return '+' + v + '% growth'; } } }
            }));

            // Jobs created
            var jobs = eco.jobs_created_spain;

            DiveDeep.renderChart('#chart-dd-jobs', DiveDeep.getBaseChartConfig({
                series: [{ name: 'New Jobs (K)', data: jobs.values }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { borderRadius: 6, columnWidth: '55%' } },
                colors: ['#5856d6'],
                xaxis: { categories: jobs.years },
                yaxis: { labels: { formatter: function(v) { return v + 'K'; } } },
                dataLabels: { enabled: true, formatter: function(v) { return v + 'K'; }, style: { fontSize: '10px', fontWeight: 600, colors: ['#fff'] } },
                tooltip: { y: { formatter: function(v) { return v.toLocaleString() + ' thousand new jobs'; } } }
            }));
        }

        // ============================================================
        // SECTION 3: University & Education
        // ============================================================
        function initUniversityCharts() {
            var uni = DATA.university_education;

            // Enrollment trend
            var enrSeries = [];
            ['ES','FR','DE','UK'].forEach(function(code) {
                enrSeries.push({
                    name: CN[code],
                    data: uni.enrollment_trend.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-enrollment', DiveDeep.getBaseChartConfig({
                series: enrSeries,
                chart: { type: 'line', height: 280 },
                colors: ['ES','FR','DE','UK'].map(function(c) { return CC[c]; }),
                stroke: { curve: 'smooth', width: 2.5 },
                markers: { size: 3 },
                xaxis: { categories: uni.enrollment_trend.years },
                yaxis: { min: 1400, max: 2400, labels: { formatter: function(v) { return (v/1000).toFixed(1) + 'M'; } } },
                tooltip: { y: { formatter: function(v) { return v.toLocaleString() + ' thousand students'; } } },
                legend: { position: 'bottom' },
                annotations: { xaxis: [{ x: 1998, borderColor: '#5856d6', strokeDashArray: 4, label: { text: 'Spain peak', style: { background: '#5856d6', color: '#fff', fontSize: '9px' } } }] }
            }), enrSeries);

            // Tertiary enrollment rate
            var ter = uni.tertiary_enrollment_rate;
            var terColors = ter.countries.map(function(c) { return c === 'ES' ? CC.ES : (CC[c] || '#86868b'); });

            DiveDeep.renderChart('#chart-dd-tertiary', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Enrollment %', data: ter.values }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: terColors,
                xaxis: { categories: ter.labels, max: 60 },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '12px' } } },
                dataLabels: { enabled: true, formatter: function(v) { return v + '%'; }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) { return v + '% of 18-24'; } } }
            }));

            // Graduation rate
            var grad = uni.graduation_rate_2000;
            var gradColors = grad.countries.map(function(c) { return c === 'ES' ? CC.ES : (CC[c] || '#86868b'); });

            DiveDeep.renderChart('#chart-dd-graduation', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Graduation %', data: grad.values }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: gradColors,
                xaxis: { categories: grad.labels, max: 50 },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '12px' } } },
                dataLabels: { enabled: true, formatter: function(v) { return v + '%'; }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) { return v + '% completion'; } } }
            }));

            // Fields of study
            var fields = uni.field_of_study_2000;
            var fieldSeries = [];
            ['ES','FR','UK'].forEach(function(code) {
                fieldSeries.push({
                    name: CN[code],
                    data: fields.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-fields', DiveDeep.getBaseChartConfig({
                series: fieldSeries,
                chart: { type: 'bar', height: 280 },
                colors: ['ES','FR','UK'].map(function(c) { return CC[c]; }),
                plotOptions: { bar: { horizontal: false, columnWidth: '65%', borderRadius: 3 } },
                xaxis: { categories: fields.categories },
                yaxis: { max: 45, labels: { formatter: function(v) { return v + '%'; } } },
                legend: { position: 'bottom' },
                tooltip: { y: { formatter: function(v) { return v + '% of enrollment'; } } }
            }), fieldSeries);
        }

        // ============================================================
        // SECTION 4: Euro & Globalization
        // ============================================================
        function initEuroCharts() {
            var euro = DATA.euro_globalization;

            // Inflation convergence
            var infSeries = [];
            ['ES','FR','DE','IT','EU'].forEach(function(code) {
                infSeries.push({
                    name: CN[code] || code,
                    data: euro.inflation_convergence.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-inflation', DiveDeep.getBaseChartConfig({
                series: infSeries,
                chart: { type: 'line', height: 280 },
                colors: ['ES','FR','DE','IT','EU'].map(function(c) { return CC[c]; }),
                stroke: { curve: 'smooth', width: 2.5 },
                markers: { size: 3 },
                xaxis: { categories: euro.inflation_convergence.years },
                yaxis: { min: 0, max: 6, labels: { formatter: function(v) { return v + '%'; } } },
                tooltip: { y: { formatter: function(v) { return v + '% inflation'; } } },
                legend: { position: 'bottom' },
                annotations: {
                    xaxis: [
                        { x: 1999, borderColor: '#34c759', strokeDashArray: 0, label: { text: 'Euro launched', style: { background: '#34c759', color: '#fff', fontSize: '9px' } } }
                    ],
                    yaxis: [{ y: 3, borderColor: 'rgba(255,59,48,0.4)', strokeDashArray: 4, label: { text: 'Maastricht limit', position: 'right', style: { background: '#ff3b30', color: '#fff', fontSize: '9px' } } }]
                }
            }), infSeries);

            // Exchange rates — normalized as index (Spain=100)
            var ex = euro.exchange_rate_last;
            var exColors = ['#ff3b30', '#0071e3', '#ff9500', '#34c759'];

            DiveDeep.renderChart('#chart-dd-exchange', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Rate per Euro', data: ex.rates_per_euro }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: exColors,
                xaxis: { categories: ex.labels,
                    labels: { formatter: function(v) {
                        if (v >= 100) return v.toLocaleString();
                        return v.toFixed(2);
                    }}
                },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '11px' } } },
                dataLabels: { enabled: true, formatter: function(v) {
                    if (v >= 100) return v.toLocaleString();
                    return v.toFixed(2);
                }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) {
                    if (v >= 100) return v.toLocaleString() + ' per Euro';
                    return v.toFixed(5) + ' per Euro';
                } } }
            }));

            // FDI inflows
            var fdi = euro.fdi_inflows;
            var fdiSeries = [];
            ['ES','FR','DE','UK'].forEach(function(code) {
                fdiSeries.push({
                    name: CN[code],
                    data: fdi.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-fdi', DiveDeep.getBaseChartConfig({
                series: fdiSeries,
                chart: { type: 'area', height: 280 },
                colors: ['ES','FR','DE','UK'].map(function(c) { return CC[c]; }),
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.3, opacityTo: 0.05 } },
                stroke: { curve: 'smooth', width: 2.5 },
                xaxis: { categories: fdi.years },
                yaxis: { labels: { formatter: function(v) { return '$' + v + 'B'; } } },
                tooltip: { y: { formatter: function(v) { return '$' + v.toFixed(1) + ' billion'; } } },
                legend: { position: 'bottom' },
                annotations: { xaxis: [{ x: 2000, borderColor: '#ff9500', strokeDashArray: 4, label: { text: 'Dot-com peak FDI', style: { background: '#ff9500', color: '#fff', fontSize: '9px' } } }] }
            }), fdiSeries);
        }

        // ============================================================
        // SECTION 5: Tech & Society
        // ============================================================
        function initTechCharts() {
            var tech = DATA.tech_society;

            // Mobile penetration
            var mobSeries = [];
            ['ES','FR','DE','UK','IT','US'].forEach(function(code) {
                mobSeries.push({
                    name: CN[code],
                    data: tech.mobile_penetration.series[code],
                    countryCode: code
                });
            });

            DiveDeep.renderChart('#chart-dd-mobile', DiveDeep.getBaseChartConfig({
                series: mobSeries,
                chart: { type: 'line', height: 280 },
                colors: ['ES','FR','DE','UK','IT','US'].map(function(c) { return CC[c]; }),
                stroke: { curve: 'smooth', width: 2.5 },
                markers: { size: 3 },
                xaxis: { categories: tech.mobile_penetration.years },
                yaxis: { min: 0, max: 100, labels: { formatter: function(v) { return v + '/100'; } } },
                tooltip: { y: { formatter: function(v) { return v + ' per 100 people'; } } },
                legend: { position: 'bottom' }
            }), mobSeries);

            // PC households
            var pc = tech.pc_households_2000;
            var pcColors = pc.countries.map(function(c) { return c === 'ES' ? CC.ES : (CC[c] || '#86868b'); });

            DiveDeep.renderChart('#chart-dd-pc', DiveDeep.getBaseChartConfig({
                series: [{ name: 'Households %', data: pc.values }],
                chart: { type: 'bar', height: 240 },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, barHeight: '60%', distributed: true } },
                colors: pcColors,
                xaxis: { categories: pc.labels, max: 60 },
                yaxis: { labels: { style: { colors: '#f0f0f0', fontSize: '12px' } } },
                dataLabels: { enabled: true, formatter: function(v) { return v + '%'; }, style: { fontSize: '11px', fontWeight: 600, colors: ['#fff'] } },
                legend: { show: false },
                tooltip: { y: { formatter: function(v) { return v + '% of households'; } } }
            }));
        }

        // ============================================================
        // SECTION 6: Personal
        // ============================================================
        function initPersonalCharts() {
            var p = DATA.personal.university_journey;

            // My path
            var annotations = p.spain_events.map(function(ev, i) {
                return {
                    x: p.years[i],
                    borderColor: '#5856d6',
                    strokeDashArray: 0,
                    label: {
                        text: ev,
                        orientation: 'horizontal',
                        position: i % 2 === 0 ? 'top' : 'bottom',
                        style: {
                            background: '#222',
                            color: '#f0f0f0',
                            fontSize: '9px',
                            padding: { left: 4, right: 4, top: 2, bottom: 2 }
                        }
                    }
                };
            });

            DiveDeep.renderChart('#chart-dd-mypath', DiveDeep.getBaseChartConfig({
                series: [{ name: 'My Age', data: p.ages }],
                chart: { type: 'area', height: 320 },
                colors: ['#5856d6'],
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.05 } },
                stroke: { curve: 'smooth', width: 3 },
                markers: { size: 6, hover: { size: 8 } },
                xaxis: { categories: p.years, labels: { rotate: -45, style: { colors: '#f0f0f0', fontSize: '10px' } } },
                yaxis: { min: 17, max: 25, labels: { formatter: function(v) { return 'Age ' + v; } } },
                annotations: { xaxis: annotations },
                tooltip: {
                    custom: function(opts) {
                        var i = opts.dataPointIndex;
                        var isLeft = p.levels[i].indexOf('Left') !== -1;
                        var badge = isLeft ? ' <span style="color:#ff9500;font-size:10px">(Pivoted)</span>' : '';
                        return '<div style="padding:8px 12px;background:#1a1a1a;border:1px solid rgba(255,255,255,0.1);border-radius:6px;">' +
                            '<strong style="color:#5856d6">' + p.years[i] + '</strong><br>' +
                            '<span style="color:#f0f0f0;font-weight:600">' + p.levels[i] + '</span>' + badge + ' (Age ' + p.ages[i] + ')<br>' +
                            '<span style="color:#888;font-size:11px">' + p.spain_events[i] + '</span></div>';
                    }
                }
            }));

            // Generation comparison
            var gen = DATA.personal.generation_comparison;

            DiveDeep.renderChart('#chart-dd-generations', DiveDeep.getBaseChartConfig({
                series: [
                    { name: gen.labels[0], data: gen.born_1978 },
                    { name: gen.labels[1], data: gen.born_1988 }
                ],
                chart: { type: 'radar', height: 280 },
                colors: ['#5856d6', '#34c759'],
                stroke: { width: 2 },
                fill: { opacity: 0.2 },
                markers: { size: 3 },
                xaxis: { categories: gen.categories, labels: { style: { colors: '#f0f0f0', fontSize: '10px' } } },
                yaxis: { show: false },
                legend: { position: 'bottom' },
                tooltip: { y: { formatter: function(v) { return v; } } }
            }));
        }

        // ============================================================
        // SERIES TOGGLES
        // ============================================================
        function initSeriesToggles() {
            DiveDeep.initSeriesToggle('#chart-dd-internet', '#toggle-internet');
            DiveDeep.initSeriesToggle('#chart-dd-gdp', '#toggle-gdp');
            DiveDeep.initSeriesToggle('#chart-dd-unemployment', '#toggle-unemployment');
            DiveDeep.initSeriesToggle('#chart-dd-enrollment', '#toggle-enrollment');
            DiveDeep.initSeriesToggle('#chart-dd-fields', '#toggle-fields');
            DiveDeep.initSeriesToggle('#chart-dd-inflation', '#toggle-inflation');
            DiveDeep.initSeriesToggle('#chart-dd-fdi', '#toggle-fdi');
            DiveDeep.initSeriesToggle('#chart-dd-mobile', '#toggle-mobile');
        }

        // ============================================================
        // SCOPE CHANGE HANDLER
        // ============================================================
        function initScopeUpdates() {
            DiveDeep.onScopeChange(function(scope, countries) {
                var chartMap = {
                    '#chart-dd-internet': ['ES','FR','DE','UK','US','JP','World'],
                    '#chart-dd-gdp': ['ES','FR','DE','UK','US','EU'],
                    '#chart-dd-unemployment': ['ES','FR','DE','UK','US','EU'],
                    '#chart-dd-enrollment': ['ES','FR','DE','UK'],
                    '#chart-dd-fields': ['ES','FR','UK'],
                    '#chart-dd-inflation': ['ES','FR','DE','IT','EU'],
                    '#chart-dd-fdi': ['ES','FR','DE','UK'],
                    '#chart-dd-mobile': ['ES','FR','DE','UK','IT','US']
                };

                var toggleMap = {
                    '#chart-dd-internet': '#toggle-internet',
                    '#chart-dd-gdp': '#toggle-gdp',
                    '#chart-dd-unemployment': '#toggle-unemployment',
                    '#chart-dd-enrollment': '#toggle-enrollment',
                    '#chart-dd-fields': '#toggle-fields',
                    '#chart-dd-inflation': '#toggle-inflation',
                    '#chart-dd-fdi': '#toggle-fdi',
                    '#chart-dd-mobile': '#toggle-mobile'
                };

                Object.keys(chartMap).forEach(function(sel) {
                    var chart = DiveDeep.charts[sel];
                    if (!chart) return;

                    chartMap[sel].forEach(function(code) {
                        var name = CN[code] || code;
                        if (countries.indexOf(code) !== -1 || code === 'EU' || code === 'World') {
                            chart.showSeries(name);
                        } else {
                            chart.hideSeries(name);
                        }
                    });

                    var toggleId = toggleMap[sel];
                    if (toggleId) {
                        var container = document.querySelector(toggleId);
                        if (container) {
                            container.querySelectorAll('.dd-series-btn').forEach(function(btn) {
                                var seriesName = btn.dataset.series;
                                var code = Object.keys(CN).find(function(k) { return CN[k] === seriesName; }) || seriesName;
                                if (code === 'WLD') code = 'World';
                                if (countries.indexOf(code) !== -1 || code === 'EU' || code === 'World') {
                                    btn.classList.add('active');
                                } else {
                                    btn.classList.remove('active');
                                }
                            });
                        }
                    }
                });
            });
        }

    })();
    </script>

</body>
</html>
